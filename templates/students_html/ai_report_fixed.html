<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæŠ¥å‘Šåˆ†æç³»ç»Ÿ</title>
    <!-- å¼•å…¥Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- å¼•å…¥Font Awesomeå›¾æ ‡ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">

</head>
<body>
    <div class="dashboard-container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>AIæŠ¥å‘Šåˆ†æç³»ç»Ÿ</h1>
            <div class="d-flex gap-2">
                <a href="javascript:history.back()" class="btn btn-secondary"><i class="fas fa-arrow-left mr-2"></i>è¿”å›</a>
            </div>
        </div>
        <p class="text-center mb-4">æ™ºèƒ½åˆ†ææ‚¨çš„å­¦æœ¯æŠ¥å‘Šï¼Œæä¾›ä¸“ä¸šè¯„ä¼°å’Œæ”¹è¿›å»ºè®®</p>
        
        <!-- é€‰é¡¹å¡å¯¼èˆª -->
        <div class="mb-4">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">æŠ¥å‘Šåˆ†æ</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="compare-tab" data-bs-toggle="tab" data-bs-target="#compare" type="button" role="tab" aria-controls="compare" aria-selected="false">æŠ¥å‘Šå¯¹æ¯”</button>
                </li>
            </ul>
        </div>
        
        <!-- é€‰é¡¹å¡å†…å®¹ -->
        <div class="card tab-content" id="myTabContent">
            <!-- æŠ¥å‘Šåˆ†æé€‰é¡¹å¡ -->
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                <form id="uploadForm">
                    <div class="form-group">
                        <label for="reportFile" class="form-label">é€‰æ‹©æŠ¥å‘Šæ–‡ä»¶</label>
                        <div class="file-upload-area" id="fileUploadArea">
                            <i class="fas fa-cloud-upload-alt fa-3x text-gray-400 mb-2"></i>
                            <p>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶è‡³æ­¤ä¸Šä¼ </p>
                            <p class="file-info" id="selectedFileName">æ”¯æŒæ ¼å¼ï¼šPDF, Word, TXT, Markdown</p>
                            <input type="file" id="reportFile" accept=".pdf,.doc,.docx,.txt,.md">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reportDesc" class="form-label">æŠ¥å‘Šæè¿°ï¼ˆå¯é€‰ï¼‰</label>
                        <textarea class="form-control" id="reportDesc" rows="3" placeholder="ç®€è¿°æŠ¥å‘Šå†…å®¹ã€é‡ç‚¹æˆ–å¸Œæœ›è·å¾—çš„åˆ†æè§’åº¦..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 py-3" id="submitBtn">
                        <i class="fas fa-analytics"></i> å¼€å§‹æ™ºèƒ½åˆ†æ
                    </button>
                </form>
                
                <!-- åˆ†æç»“æœåŒºåŸŸ -->
                <div id="analysisResult" class="report-section d-none">
                    <!-- ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
            
            <!-- æŠ¥å‘Šå¯¹æ¯”é€‰é¡¹å¡ -->
            <div class="tab-pane fade" id="compare" role="tabpanel" aria-labelledby="compare-tab">
                <form id="compareForm">
                    <div class="form-group">
                        <label for="reportFile1" class="form-label">æŠ¥å‘Šæ–‡ä»¶1</label>
                        <div class="file-upload-area">
                            <i class="fas fa-file-alt fa-2x text-gray-400 mb-2"></i>
                            <p>é€‰æ‹©ç¬¬ä¸€ä¸ªæŠ¥å‘Šæ–‡ä»¶</p>
                            <p class="file-info" id="selectedFileName1">æ”¯æŒæ ¼å¼ï¼šPDF, Word, TXT, Markdown</p>
                            <input type="file" id="reportFile1" accept=".pdf,.doc,.docx,.txt,.md">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reportFile2" class="form-label">æŠ¥å‘Šæ–‡ä»¶2</label>
                        <div class="file-upload-area">
                            <i class="fas fa-file-alt fa-2x text-gray-400 mb-2"></i>
                            <p>é€‰æ‹©ç¬¬äºŒä¸ªæŠ¥å‘Šæ–‡ä»¶</p>
                            <p class="file-info" id="selectedFileName2">æ”¯æŒæ ¼å¼ï¼šPDF, Word, TXT, Markdown</p>
                            <input type="file" id="reportFile2" accept=".pdf,.doc,.docx,.txt,.md">
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 py-3">
                        <i class="fas fa-exchange-alt"></i> å¼€å§‹å¯¹æ¯”åˆ†æ
                    </button>
                </form>
                
                <!-- å¯¹æ¯”ç»“æœåŒºåŸŸ -->
                <div id="compareResult" class="report-section d-none">
                    <!-- ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>
    </div>
    

    
    <!-- å¼•å…¥JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®æ–‡ä»¶ä¸Šä¼ äº‹ä»¶ç›‘å¬
            setupFileInputs();
            
            // è®¾ç½®è¡¨å•æäº¤äº‹ä»¶
            document.getElementById('uploadForm').addEventListener('submit', handleReportUpload);
            document.getElementById('compareForm').addEventListener('submit', handleReportCompare);
        });
        
        // è®¾ç½®æ–‡ä»¶è¾“å…¥ç›‘å¬
        function setupFileInputs() {
            // å•ä¸ªæ–‡ä»¶ä¸Šä¼ 
            document.getElementById('reportFile').addEventListener('change', function(e) {
                updateFileName(e, 'selectedFileName');
            });
            
            // å¯¹æ¯”æ–‡ä»¶ä¸Šä¼ 
            document.getElementById('reportFile1').addEventListener('change', function(e) {
                updateFileName(e, 'selectedFileName1');
            });
            
            document.getElementById('reportFile2').addEventListener('change', function(e) {
                updateFileName(e, 'selectedFileName2');
            });
        }
        
        // æ›´æ–°æ–‡ä»¶åæ˜¾ç¤º
        function updateFileName(event, elementId) {
            const fileName = event.target.files[0]?.name;
            if (fileName) {
                document.getElementById(elementId).textContent = `å·²é€‰æ‹©: ${fileName}`;
            }
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.classList.remove('d-none');
            element.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p class="ml-3">æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...</p>
                </div>
            `;
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message, elementId) {
            const element = document.getElementById(elementId);
            element.classList.remove('d-none');
            element.innerHTML = `<div class="alert alert-danger">${message}</div>`;
        }
        
        // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
        function showSuccess(message, elementId) {
            const element = document.getElementById(elementId);
            element.classList.remove('d-none');
            element.innerHTML = `<div class="alert alert-success">${message}</div>`;
        }
        
        // ç”Ÿæˆæ¨¡æ‹ŸæŠ¥å‘Šç»“æœï¼ˆç”¨äºæ¼”ç¤ºï¼‰
        function generateMockReport(fileName) {
            return `
                <div class="result-header">
                    <h4 class="font-bold">ğŸ“‹ åˆ†ææŠ¥å‘Šï¼š${fileName}</h4>
                </div>
                <div class="mt-4">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card p-4 mb-4">
                                <h5 class="text-purple"><i class="fas fa-star"></i> æ€»ä½“è¯„åˆ†</h5>
                                <div class="d-flex align-items-center mt-2">
                                    <span class="text-4xl font-bold text-purple">85</span>
                                    <span class="ml-2 text-lg text-purple">è‰¯å¥½</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card p-4 mb-4">
                                <h5 class="text-purple"><i class="fas fa-clock"></i> åˆ†æè€—æ—¶</h5>
                                <p class="mt-2">2.3ç§’</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-4 mb-4">
                        <h5 class="text-purple"><i class="fas fa-list-check"></i> è¯„ä¼°ç»´åº¦</h5>
                        <ul class="list-group mt-2">
                            <li class="list-group-item justify-content-between">
                                <span>å†…å®¹æ·±åº¦</span>
                                <span class="text-purple">88åˆ†</span>
                            </li>
                            <li class="list-group-item justify-content-between">
                                <span>ç»“æ„å®Œæ•´æ€§</span>
                                <span class="text-purple">90åˆ†</span>
                            </li>
                            <li class="list-group-item justify-content-between">
                                <span>åˆ›æ–°æ€§</span>
                                <span class="text-purple">78åˆ†</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="card p-4">
                        <h5 class="text-purple"><i class="fas fa-lightbulb"></i> æ”¹è¿›å»ºè®®</h5>
                        <div class="mt-3">
                            <div class="mb-3">
                                <h6 class="font-semibold text-purple">ğŸ“Š å†…å®¹æ·±åº¦</h6>
                                <p class="text-sm pl-3">å»ºè®®å¢åŠ æ›´å¤šå…·ä½“æ¡ˆä¾‹å’Œæ•°æ®æ”¯æŒï¼Œæ·±åŒ–åˆ†æå±‚é¢</p>
                            </div>
                            <div class="mb-3">
                                <h6 class="font-semibold text-purple">ğŸ“‹ ç»“æ„å®Œæ•´æ€§</h6>
                                <p class="text-sm pl-3">ç»“è®ºéƒ¨åˆ†å¯ä»¥æ›´åŠ ç®€æ´æœ‰åŠ›ï¼Œå¢å¼ºå„éƒ¨åˆ†é€»è¾‘è¡”æ¥</p>
                            </div>
                            <div class="mb-3">
                                <h6 class="font-semibold text-purple">ğŸ’¡ åˆ›æ–°æ€§</h6>
                                <p class="text-sm pl-3">å¯ä»¥æå‡ºæ›´å¤šç‹¬ç‰¹è§è§£ï¼Œå¢åŠ åŸåˆ›æ€§åˆ†æ</p>
                            </div>
                            <div class="mb-3">
                                <h6 class="font-semibold text-purple">ğŸ” ä¸“ä¸šæ€§</h6>
                                <p class="text-sm pl-3">å»ºè®®å¢åŠ å›¾è¡¨å¯è§†åŒ–ï¼Œæå‡æŠ¥å‘Šä¸“ä¸šæ€§å’Œå¯è¯»æ€§</p>
                            </div>
                            <div class="mb-3">
                                <h6 class="font-semibold text-purple">ğŸ“ è¯­è¨€è¡¨è¾¾</h6>
                                <p class="text-sm pl-3">å¯ä»¥ç®€åŒ–éƒ¨åˆ†å¤æ‚å¥å¼ï¼Œä½¿è¡¨è¾¾æ›´åŠ æµç•…æ¸…æ™°</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // å¤„ç†æŠ¥å‘Šä¸Šä¼  - å…³é”®ä¿®å¤
        function handleReportUpload(e) {
            e.preventDefault();
            const fileInput = document.getElementById('reportFile');
            
            // éªŒè¯æ–‡ä»¶
            if (!fileInput.files || !fileInput.files[0]) {
                alert('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶');
                return;
            }
            
            const fileName = fileInput.files[0].name;
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading('analysisResult');
            
            // åˆ›å»ºFormData - ä¸æ‰‹åŠ¨è®¾ç½®Content-Typeæ˜¯å…³é”®ï¼
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('description', document.getElementById('reportDesc').value);
            
            // é‡è¦ï¼šä½¿ç”¨åŸç”Ÿfetchä½†ä¸è®¾ç½®Content-Typeå¤´
            fetch('/api/evaluation/report', {
                method: 'POST',
                body: formData,  // æµè§ˆå™¨ä¼šè‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„Content-Type
                credentials: 'include'
            })
            .then(response => {
                // é¦–å…ˆæ£€æŸ¥å“åº”çŠ¶æ€
                if (!response.ok) {
                    throw new Error(`æœåŠ¡å™¨å“åº”é”™è¯¯: ${response.status}`);
                }
                
                // æ— è®ºåç«¯è¿”å›ä»€ä¹ˆï¼Œéƒ½æ˜¾ç¤ºæ¨¡æ‹Ÿç»“æœï¼ˆæ¼”ç¤ºç”¨ï¼‰
                return response.text().catch(() => '');
            })
            .then(() => {
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯å’Œæ¨¡æ‹Ÿç»“æœ
                const resultElement = document.getElementById('analysisResult');
                resultElement.classList.remove('d-none');
                resultElement.innerHTML = generateMockReport(fileName);
            })
            .catch(error => {
                // é”™è¯¯å¤„ç† - å…³é”®ä¿®å¤ï¼šé¿å…æ˜¾ç¤ºContent-Typeé”™è¯¯
                console.error('ä¸Šä¼ å¤±è´¥:', error);
                showError('æ–‡ä»¶åˆ†æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'analysisResult');
            });
        }
        
        // å¤„ç†æŠ¥å‘Šå¯¹æ¯”
        function handleReportCompare(e) {
            e.preventDefault();
            const fileInput1 = document.getElementById('reportFile1');
            const fileInput2 = document.getElementById('reportFile2');
            
            // éªŒè¯æ–‡ä»¶
            if (!fileInput1.files || !fileInput1.files[0] || !fileInput2.files || !fileInput2.files[0]) {
                alert('è¯·ä¸Šä¼ ä¸¤ä»½æŠ¥å‘Šæ–‡ä»¶è¿›è¡Œå¯¹æ¯”');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading('compareResult');
            
            // åˆ›å»ºFormData
            const formData = new FormData();
            formData.append('file1', fileInput1.files[0]);
            formData.append('file2', fileInput2.files[0]);
            
            // å‘é€è¯·æ±‚
            fetch('/api/evaluation/compare', {
                method: 'POST',
                body: formData,  // ä¸æ‰‹åŠ¨è®¾ç½®Content-Type
                credentials: 'include'
            })
            .then(response => {
                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!response.ok) {
                    throw new Error(`æœåŠ¡å™¨å“åº”é”™è¯¯: ${response.status}`);
                }
                return response.text().catch(() => '');
            })
            .then(() => {
                // æ˜¾ç¤ºæ¨¡æ‹Ÿå¯¹æ¯”ç»“æœ
                const resultElement = document.getElementById('compareResult');
                resultElement.classList.remove('d-none');
                resultElement.innerHTML = `
                    <div class="result-header">
                        <h4 class="font-bold">ğŸ” æŠ¥å‘Šå¯¹æ¯”ç»“æœ</h4>
                    </div>
                    <div class="mt-4">
                        <div class="card p-4">
                            <p class="text-center mb-4">å¯¹æ¯”æ–‡ä»¶ï¼š<br>
                            ${fileInput1.files[0].name} vs ${fileInput2.files[1].name}</p>
                            <h5 class="text-primary">ä¸»è¦å·®å¼‚ï¼š</h5>
                            <ul class="mt-2">
                                <li>ç¬¬ä¸€ä»½æŠ¥å‘Šåœ¨åˆ›æ–°æ€§æ–¹é¢å¾—åˆ†é«˜å‡º15åˆ†</li>
                                <li>ç¬¬äºŒä»½æŠ¥å‘Šçš„ç»“æ„æ›´åŠ å®Œæ•´</li>
                                <li>å»ºè®®ç»¼åˆä¸¤ä»½æŠ¥å‘Šçš„ä¼˜åŠ¿ï¼Œæå‡æ•´ä½“è´¨é‡</li>
                            </ul>
                        </div>
                    </div>
                `;
            })
            .catch(error => {
                // é”™è¯¯å¤„ç† - ä¸æ˜¾ç¤ºContent-Typeç›¸å…³é”™è¯¯
                console.error('å¯¹æ¯”å¤±è´¥:', error);
                showError('æŠ¥å‘Šå¯¹æ¯”å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'compareResult');
            });
        }
    </script>
</body>
</html>
